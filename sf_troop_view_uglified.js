const getTroops=()=>{let t=0,e=0,n=0,o=0,r=0,a=0,s=0,l=0,d=0;return $($("div#ally_content table")[1]).find("tr").each((i,h)=>{if(0===i)return;t+=parseInt($(h).children("td:nth-child(2)").text().trim(),10),e+=parseInt($(h).children("td:nth-child(3)").text().trim(),10);const f=parseInt($(h).children("td:nth-child(4)").text().trim(),10),c=parseInt($(h).children("td:nth-child(6)").text().trim(),10);n+=parseInt($(h).children("td:nth-child(7)").text().trim(),10);const p=parseInt($(h).children("td:nth-child(9)").text().trim(),10);f>=3e3&&f<4e3&&c>1e3?o++:f>=4e3&&f<5e3&&c>1e3?r++:f>=5e3&&f<6e3&&c>1500?a++:f>=6e3&&c>2e3&&s++,p>=30&&p<100?l++:p>=100&&d++}),{tSpear:t,tSword:e,tHeavy:n,off3000:o,off4000:r,off5000:a,off6000p:s,katas30x100:l,katas100p:d}},getUserName=()=>$("[name='player_id'] option:selected").text().trim(),getIsoDate=()=>(new Date).toISOString(),getTroopsFromLocalStorage=()=>{const t=window.localStorage.getItem("sf_troops");return t?JSON.parse(t):{}},setTroopsToLocalStorage=t=>{window.localStorage.setItem("sf_troops",JSON.stringify(t))},addCurrentUserToLocalStorage=()=>{const t=getUserName();if("Mitglied auswÃ¤hlen"===t)return;const e=getTroops(),n=getIsoDate(),o={...getTroopsFromLocalStorage(),[t]:{troopValues:e,lastUpdated:n}};setTroopsToLocalStorage(o)},isoDateToString=t=>{const e=new Date(t);return("0"+e.getDate()).slice(-2)+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+e.getFullYear()+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)},registerCollapsibleListener=()=>{const t=document.getElementsByClassName("collapsible");for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(){var t=this.nextElementSibling;"block"===t.style.display?t.style.display="none":t.style.display="block"})},renderTroopsAsTable=()=>{const t=getTroopsFromLocalStorage();if(Object.keys(t).length>0){const e={tSpear:0,tSword:0,tHeavy:0,off3000:0,off4000:0,off5000:0,off6000p:0,katas30x100:0,katas100p:0},n=Object.keys(t).sort().reduce((e,n)=>(e[n]=t[n],e),{}),o=Object.keys(n).map(n=>{const{tSpear:o,tSword:r,tHeavy:a,off3000:s,off4000:l,off5000:d,off6000p:i,katas30x100:h,katas100p:f}=t[n].troopValues;e.tSpear+=o,e.tSword+=r,e.tHeavy+=a,e.off3000+=s,e.off4000+=l,e.off5000+=d,e.off6000p+=i,e.katas30x100+=h,e.katas100p+=f;const c=t[n].lastUpdated;return`<tr>\n     <td>${n}</td>\n     <td>${o}</td>\n     <td>${r}</td>\n     <td>${a}</td>\n     <td>${s}</td>\n     <td>${l}</td>\n     <td>${d}</td>\n     <td>${i}</td>\n     <td>${h}</td>\n     <td>${f}</td>\n     <td>${isoDateToString(c)}</td>\n  </tr>`}).join(""),r=`<tr>\n    <th style="font-weight: bold;">Gesamt</th>\n    <th>${e.tSpear}</th>\n    <th>${e.tSword}</th>\n    <th>${e.tHeavy}</th>\n    <th>${e.off3000}</th>\n    <th>${e.off4000}</th>\n    <th>${e.off5000}</th>\n    <th>${e.off6000p}</th>\n    <th>${e.katas30x100}</th>\n    <th>${e.katas100p}</th>\n    <th>${isoDateToString((new Date).toISOString())}</th>\n </tr>`;$(`<button type="button" class="collapsible">SF-Truppen</button>\n<div class="table-responsive" style="display: none;">\n   <table class="vis w100">\n      <tbody>\n         <tr>\n            <th>Spieler</th>\n            <th>Speer</th>\n            <th>Schwert</th>\n            <th>Skav</th>\n            <th>3k+ Off</th>\n            <th>4k+ Off</th>\n            <th>5k+ Off</th>\n            <th>6k+ Off</th>\n            <th>30-100 Katas</th>\n            <th>100+ Katas</th>\n            <th>Zuletzt aktualisiert</th>\n         </tr>\n         ${o}\n         ${r}\n      </tbody>\n   </table>\n</div>`).insertAfter("[name='player_id']")}};addCurrentUserToLocalStorage(),renderTroopsAsTable(),registerCollapsibleListener();