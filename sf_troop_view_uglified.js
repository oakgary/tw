const getTroops=()=>{let t=0,e=0,o=0,n=0,s=0,a=0;return $($("div#ally_content table")[1]).find("tr").each((r,l)=>{if(0===r)return;const i=parseInt($(l).children("td:nth-child(4)").text().trim(),10),f=parseInt($(l).children("td:nth-child(6)").text().trim(),10),d=parseInt($(l).children("td:nth-child(9)").text().trim(),10);i>=3e3&&i<4e3&&f>1e3?t++:i>=4e3&&i<5e3&&f>1e3?e++:i>=5e3&&i<6e3&&f>1500?o++:i>=6e3&&f>2e3&&n++,d>=30&&d<100?s++:d>=100&&a++}),{off3000:t,off4000:e,off5000:o,off6000p:n,katas30x100:s,katas100p:a}},getUserName=()=>$("[name='player_id'] option:selected").text().trim(),getIsoDate=()=>(new Date).toISOString(),getTroopsFromLocalStorage=()=>{const t=window.localStorage.getItem("sf_troops");return t?JSON.parse(t):{}},setTroopsToLocalStorage=t=>{window.localStorage.setItem("sf_troops",JSON.stringify(t))},addCurrentUserToLocalStorage=()=>{const t=getUserName();if("Mitglied auswÃ¤hlen"===t)return;const e=getTroops(),o=getIsoDate(),n={...getTroopsFromLocalStorage(),[t]:{troopValues:e,lastUpdated:o}};setTroopsToLocalStorage(n)},isoDateToString=t=>{const e=new Date(t);return("0"+e.getDate()).slice(-2)+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+e.getFullYear()+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)},registerCollapsibleListener=()=>{const t=document.getElementsByClassName("collapsible");for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(){var t=this.nextElementSibling;"block"===t.style.display?t.style.display="none":t.style.display="block"})},renderTroopsAsTable=()=>{const t=getTroopsFromLocalStorage();if(Object.keys(t).length>0){const e={off3000:0,off4000:0,off5000:0,off6000p:0,katas30x100:0,katas100p:0},o=Object.keys(t).sort().reduce((e,o)=>(e[o]=t[o],e),{}),n=Object.keys(o).map(o=>{const{off3000:n,off4000:s,off5000:a,off6000p:r,katas30x100:l,katas100p:i}=t[o].troopValues;e.off3000+=n,e.off4000+=s,e.off5000+=a,e.off6000p+=r,e.katas30x100+=l,e.katas100p+=i;const f=t[o].lastUpdated;return`<tr>\n     <td>${o}</td>\n     <td>${n}</td>\n     <td>${s}</td>\n     <td>${a}</td>\n     <td>${r}</td>\n     <td>${l}</td>\n     <td>${i}</td>\n     <td>${isoDateToString(f)}</td>\n  </tr>`}).join("");console.log(e);const s=`<tr>\n    <th style="font-weight: bold;">Gesamt</th>\n    <th>${e.off3000}</th>\n    <th>${e.off4000}</th>\n    <th>${e.off5000}</th>\n    <th>${e.off6000p}</th>\n    <th>${e.katas30x100}</th>\n    <th>${e.katas100p}</th>\n    <th>${isoDateToString((new Date).toISOString())}</th>\n </tr>`;$(`<button type="button" class="collapsible">SF-Truppen</button>\n<div class="table-responsive" style="display: none;">\n   <table class="vis w100">\n      <tbody>\n         <tr>\n            <th>Spieler</th>\n            <th>3k+ Off</th>\n            <th>4k+ Off</th>\n            <th>5k+ Off</th>\n            <th>6k+ Off</th>\n            <th>30-100 Katas</th>\n            <th>100+ Katas</th>\n            <th>Zuletzt aktualisiert</th>\n         </tr>\n         ${n}\n         ${s}\n      </tbody>\n   </table>\n</div>`).insertAfter("[name='player_id']")}};addCurrentUserToLocalStorage(),renderTroopsAsTable(),registerCollapsibleListener();